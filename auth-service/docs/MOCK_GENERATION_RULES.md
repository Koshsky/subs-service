# –ü—Ä–∞–≤–∏–ª–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –º–æ–∫–æ–≤ –∏ —Ä–∞–±–æ—Ç–∞ –º–æ–∫-–º–µ—Ç–æ–¥–æ–≤

## üéØ –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –º–æ–∫–æ–≤

### üìã –î–∏—Ä–µ–∫—Ç–∏–≤–∞ go:generate

```go
//go:generate mockery --name=IDatabase --output=./mocks --outpkg=mocks
type IDatabase interface {
    Create(value interface{}) IDatabase
    Where(query interface{}, args ...interface{}) IDatabase
    First(dest interface{}, conds ...interface{}) IDatabase
    Error() error
}
```

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `--name=IDatabase` - –∏–º—è –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –º–æ–∫–∞
- `--output=./mocks` - –ø–∞–ø–∫–∞ –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –º–æ–∫–æ–≤
- `--outpkg=mocks` - –∏–º—è –ø–∞–∫–µ—Ç–∞ –¥–ª—è –º–æ–∫–æ–≤

### üîÑ –ö–æ–º–∞–Ω–¥–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏

```bash
go generate ./...
```

## üèóÔ∏è –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –º–æ–∫–∞

### 1. –ë–∞–∑–æ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞

```go
// IDatabase is an autogenerated mock type for the IDatabase type
type IDatabase struct {
    mock.Mock  // –í—Å—Ç—Ä–∞–∏–≤–∞–µ–º testify/mock
}
```

**–ß—Ç–æ —ç—Ç–æ –∑–Ω–∞—á–∏—Ç:**
- `mock.Mock` –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –±–∞–∑–æ–≤—É—é —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å –¥–ª—è –º–æ–∫–æ–≤
- –í–∫–ª—é—á–∞–µ—Ç –º–µ—Ç–æ–¥—ã: `On()`, `Called()`, `AssertExpectations()`, –∏ –¥—Ä.

### 2. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –º–µ—Ç–æ–¥–æ–≤

–î–ª—è –∫–∞–∂–¥–æ–≥–æ –º–µ—Ç–æ–¥–∞ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π –º–æ–∫-–º–µ—Ç–æ–¥:

```go
// Create provides a mock function with given fields: value
func (_m *IDatabase) Create(value interface{}) repositories.IDatabase {
    ret := _m.Called(value)  // –í—ã–∑—ã–≤–∞–µ–º –±–∞–∑–æ–≤—ã–π –º–µ—Ç–æ–¥ mock.Mock

    if len(ret) == 0 {
        panic("no return value specified for Create")
    }

    var r0 repositories.IDatabase
    if rf, ok := ret.Get(0).(func(interface{}) repositories.IDatabase); ok {
        r0 = rf(value)  // –ï—Å–ª–∏ –≤–æ–∑–≤—Ä–∞—â–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è, –≤—ã–∑—ã–≤–∞–µ–º –µ—ë
    } else {
        if ret.Get(0) != nil {
            r0 = ret.Get(0).(repositories.IDatabase)  // –ò–Ω–∞—á–µ –ø—Ä–∏–≤–æ–¥–∏–º –∫ —Ç–∏–ø—É
        }
    }

    return r0
}
```

## üé≠ –ö–∞–∫ —Ä–∞–±–æ—Ç–∞—é—Ç –º–æ–∫-–º–µ—Ç–æ–¥—ã

### üìä –°—Ö–µ–º–∞ —Ä–∞–±–æ—Ç—ã

```
1. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–∂–∏–¥–∞–Ω–∏–π ‚Üí 2. –í—ã–∑–æ–≤ –º–µ—Ç–æ–¥–∞ ‚Üí 3. –í–æ–∑–≤—Ä–∞—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
     mock.On()              mock.Called()        ret.Get()
```

### üîß –î–µ—Ç–∞–ª—å–Ω—ã–π —Ä–∞–∑–±–æ—Ä –º–µ—Ç–æ–¥–∞ Create

```go
func (_m *IDatabase) Create(value interface{}) repositories.IDatabase {
    // 1. –í—ã–∑—ã–≤–∞–µ–º –±–∞–∑–æ–≤—ã–π –º–µ—Ç–æ–¥ mock.Mock.Called()
    ret := _m.Called(value)

    // 2. –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –±—ã–ª–æ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ
    if len(ret) == 0 {
        panic("no return value specified for Create")
    }

    // 3. –ò–∑–≤–ª–µ–∫–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
    var r0 repositories.IDatabase

    // 4. –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ –±—ã–ª–∞ –ª–∏ –≤–æ–∑–≤—Ä–∞—â–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è
    if rf, ok := ret.Get(0).(func(interface{}) repositories.IDatabase); ok {
        r0 = rf(value)  // –í—ã–∑—ã–≤–∞–µ–º —Ñ—É–Ω–∫—Ü–∏—é —Å –ø–µ—Ä–µ–¥–∞–Ω–Ω—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏
    } else {
        // 5. –ò–Ω–∞—á–µ –ø—Ä–∏–≤–æ–¥–∏–º –∫ –Ω—É–∂–Ω–æ–º—É —Ç–∏–ø—É
        if ret.Get(0) != nil {
            r0 = ret.Get(0).(repositories.IDatabase)
        }
    }

    return r0
}
```

## üéØ –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### 1. –ü—Ä–æ—Å—Ç–æ–µ –≤–æ–∑–≤—Ä–∞—â–µ–Ω–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è

```go
func TestSimpleMock(t *testing.T) {
    mockDB := new(mocks.IDatabase)

    // –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –æ–∂–∏–¥–∞–Ω–∏–µ: –ø—Ä–∏ –≤—ã–∑–æ–≤–µ Create() –≤–æ–∑–≤—Ä–∞—â–∞–µ–º —Å–∞–º –º–æ–∫
    mockDB.On("Create", mock.AnythingOfType("*models.User")).Return(mockDB)
    mockDB.On("GetError").Return(nil)

    // –í—ã–∑—ã–≤–∞–µ–º –º–µ—Ç–æ–¥
    result := mockDB.Create(&models.User{})

    // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
    assert.Equal(t, mockDB, result)
    mockDB.AssertExpectations(t)
}
```

### 2. –í–æ–∑–≤—Ä–∞—â–µ–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏

```go
func TestMockWithFunction(t *testing.T) {
    mockDB := new(mocks.IDatabase)

    // –í–æ–∑–≤—Ä–∞—â–∞–µ–º —Ñ—É–Ω–∫—Ü–∏—é, –∫–æ—Ç–æ—Ä–∞—è –±—É–¥–µ—Ç –≤—ã–∑–≤–∞–Ω–∞ —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏
    mockDB.On("Create", mock.AnythingOfType("*models.User")).Return(
        func(value interface{}) repositories.IDatabase {
            // –õ–æ–≥–∏–∫–∞ —Ñ—É–Ω–∫—Ü–∏–∏
            return mockDB
        },
    )

    result := mockDB.Create(&models.User{})
    assert.Equal(t, mockDB, result)
}
```

### 3. –û–±—Ä–∞–±–æ—Ç–∫–∞ variadic –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤

```go
func TestVariadicParameters(t *testing.T) {
    mockDB := new(mocks.IDatabase)

    // –î–ª—è –º–µ—Ç–æ–¥–æ–≤ —Å variadic –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ (args ...interface{})
    mockDB.On("Where", "email = ?", "test@example.com").Return(mockDB)
    mockDB.On("First", mock.AnythingOfType("*models.User")).Return(mockDB)
    mockDB.On("GetError").Return(nil)

    // –í—ã–∑—ã–≤–∞–µ–º —Å —Ä–∞–∑–Ω—ã–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
    result1 := mockDB.Where("email = ?", "test@example.com")
    result2 := mockDB.Where("email = ?", "test@example.com", "extra")

    assert.Equal(t, mockDB, result1)
    assert.Equal(t, mockDB, result2)
}
```

## üîç –ü—Ä–∞–≤–∏–ª–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–æ–≤ –º–µ—Ç–æ–¥–æ–≤

### 1. –ú–µ—Ç–æ–¥—ã –±–µ–∑ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤

```go
// –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å
Error() error

// –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –º–æ–∫
func (_m *IDatabase) Error() error {
    ret := _m.Called()  // –ë–µ–∑ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
    // ... –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
}
```

### 2. –ú–µ—Ç–æ–¥—ã —Å –ø—Ä–æ—Å—Ç—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏

```go
// –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å
Create(value interface{}) IDatabase

// –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –º–æ–∫
func (_m *IDatabase) Create(value interface{}) repositories.IDatabase {
    ret := _m.Called(value)  // –ü–µ—Ä–µ–¥–∞–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä
    // ... –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
}
```

### 3. –ú–µ—Ç–æ–¥—ã —Å variadic –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏

```go
// –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å
Where(query interface{}, args ...interface{}) IDatabase

// –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –º–æ–∫
func (_m *IDatabase) Where(query interface{}, args ...interface{}) repositories.IDatabase {
    var _ca []interface{}
    _ca = append(_ca, query)      // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π –ø–∞—Ä–∞–º–µ—Ç—Ä
    _ca = append(_ca, args...)    // –î–æ–±–∞–≤–ª—è–µ–º variadic –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
    ret := _m.Called(_ca...)      // –ü–µ—Ä–µ–¥–∞–µ–º –∫–∞–∫ —Å–ª–∞–π—Å
    // ... –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
}
```

### 4. –ú–µ—Ç–æ–¥—ã —Å –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–º–∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º—ã–º–∏ –∑–Ω–∞—á–µ–Ω–∏—è–º–∏

```go
// –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å
GetUserByEmail(email string) (*models.User, error)

// –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –º–æ–∫
func (_m *MockIUserRepository) GetUserByEmail(email string) (*models.User, error) {
    ret := _m.Called(email)

    var r0 *models.User
    var r1 error

    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø–µ—Ä–≤–æ–≥–æ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º–æ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è
    if rf, ok := ret.Get(0).(func(string) (*models.User, error)); ok {
        return rf(email)
    }
    if rf, ok := ret.Get(0).(func(string) *models.User); ok {
        r0 = rf(email)
    } else {
        if ret.Get(0) != nil {
            r0 = ret.Get(0).(*models.User)
        }
    }

    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—Ç–æ—Ä–æ–≥–æ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º–æ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è
    if rf, ok := ret.Get(1).(func(string) error); ok {
        r1 = rf(email)
    } else {
        r1 = ret.Error(1)
    }

    return r0, r1
}
```

## üõ†Ô∏è –ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

### 1. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ Run() –¥–ª—è —Å–ª–æ–∂–Ω–æ–π –ª–æ–≥–∏–∫–∏

```go
func TestMockWithRun(t *testing.T) {
    mockDB := new(mocks.IDatabase)

    mockDB.On("First", mock.AnythingOfType("*models.User")).Run(func(args mock.Arguments) {
        // –í—ã–ø–æ–ª–Ω—è–µ–º –∫–æ–¥ –ø—Ä–∏ –≤—ã–∑–æ–≤–µ –º–µ—Ç–æ–¥–∞
        user := args.Get(0).(*models.User)
        user.Email = "test@example.com"
        user.Password = "hashed_password"
    }).Return(mockDB)

    user := &models.User{}
    mockDB.First(user)

    assert.Equal(t, "test@example.com", user.Email)
}
```

### 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—ã–∑–æ–≤–æ–≤

```go
func TestMockAssertions(t *testing.T) {
    mockDB := new(mocks.IDatabase)

    mockDB.On("Create", mock.AnythingOfType("*models.User")).Return(mockDB)
    mockDB.On("GetError").Return(nil)

    // –í—ã–∑—ã–≤–∞–µ–º –º–µ—Ç–æ–¥—ã
    mockDB.Create(&models.User{})
    mockDB.Error()

    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –≤—Å–µ –æ–∂–∏–¥–∞–Ω–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω—ã
    mockDB.AssertExpectations(t)

    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤—ã–∑–æ–≤–æ–≤
    mockDB.AssertNumberOfCalls(t, "Create", 1)
    mockDB.AssertNumberOfCalls(t, "GetError", 1)
}
```

## üìã –ß–µ–∫-–ª–∏—Å—Ç –ø–æ–Ω–∏–º–∞–Ω–∏—è –º–æ–∫–æ–≤

- ‚úÖ **–ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å** –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –∫–æ–Ω—Ç—Ä–∞–∫—Ç
- ‚úÖ **go:generate** —É–∫–∞–∑—ã–≤–∞–µ—Ç –∫–∞–∫ –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –º–æ–∫
- ‚úÖ **mock.Mock** –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –±–∞–∑–æ–≤—É—é —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å
- ‚úÖ **Called()** –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç –≤—ã–∑–æ–≤—ã
- ‚úÖ **On()** –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç –æ–∂–∏–¥–∞–Ω–∏—è
- ‚úÖ **Return()** –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –≤–æ–∑–≤—Ä–∞—â–∞–µ–º—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è
- ‚úÖ **AssertExpectations()** –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –≤—ã–∑–æ–≤—ã
- ‚úÖ **Variadic –ø–∞—Ä–∞–º–µ—Ç—Ä—ã** –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –∫–∞–∫ —Å–ª–∞–π—Å
- ‚úÖ **–ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è** –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –ø–æ –æ—Ç–¥–µ–ª—å–Ω–æ—Å—Ç–∏
