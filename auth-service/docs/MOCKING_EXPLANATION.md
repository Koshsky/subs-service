# ĞœĞ¾ĞºĞ¸ Ğ² Ñ‚ĞµÑÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğ¸: Ğ¾Ğ±ÑŠÑÑĞ½ĞµĞ½Ğ¸Ğµ Ğ¸ Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€Ñ‹

## ğŸ¯ Ğ”Ğ»Ñ Ñ‡ĞµĞ³Ğ¾ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚ÑÑ IUserRepository Ğ¼Ğ¾Ğº?

### ğŸ“Š Ğ¡Ñ…ĞµĞ¼Ğ° Ğ°Ñ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ñ‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   AuthService   â”‚â”€â”€â”€â–¶â”‚ UserRepository   â”‚â”€â”€â”€â–¶â”‚   Database      â”‚
â”‚   (Business     â”‚    â”‚   (Data Access)  â”‚    â”‚   (PostgreSQL)  â”‚
â”‚    Logic)       â”‚    â”‚                  â”‚    â”‚                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ğŸ§ª Ğ¢ĞµÑÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ‘Ğ•Ğ— Ğ¼Ğ¾ĞºĞ¾Ğ² (Integration Tests)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   AuthService   â”‚â”€â”€â”€â–¶â”‚ UserRepository   â”‚â”€â”€â”€â–¶â”‚   Real DB       â”‚
â”‚   Test          â”‚    â”‚   (Real)         â”‚    â”‚   (Setup/Teardown)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ĞŸÑ€Ğ¾Ğ±Ğ»ĞµĞ¼Ñ‹:**
- ğŸŒ ĞœĞµĞ´Ğ»ĞµĞ½Ğ½Ğ¾ (Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ° Ğ‘Ğ”, Ğ¼Ğ¸Ğ³Ñ€Ğ°Ñ†Ğ¸Ğ¸)
- ğŸ”— Ğ—Ğ°Ğ²Ğ¸ÑĞ¸Ñ‚ Ğ¾Ñ‚ Ğ²Ğ½ĞµÑˆĞ½Ğ¸Ñ… Ñ€ĞµÑÑƒÑ€ÑĞ¾Ğ²
- ğŸ› ï¸ Ğ¡Ğ»Ğ¾Ğ¶Ğ½Ğ°Ñ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ°
- ğŸ’¥ Ğ¥Ñ€ÑƒĞ¿ĞºĞ¸Ğµ Ñ‚ĞµÑÑ‚Ñ‹

### ğŸš€ Ğ¢ĞµÑÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ¡ Ğ¼Ğ¾ĞºĞ°Ğ¼Ğ¸ (Unit Tests)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   AuthService   â”‚â”€â”€â”€â–¶â”‚ Mock Repository  â”‚
â”‚   Test          â”‚    â”‚   (Fake)         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ĞŸÑ€ĞµĞ¸Ğ¼ÑƒÑ‰ĞµÑÑ‚Ğ²Ğ°:**
- âš¡ Ğ‘Ñ‹ÑÑ‚Ñ€Ğ¾ (Ğ½ĞµÑ‚ Ñ€ĞµĞ°Ğ»ÑŒĞ½Ñ‹Ñ… Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¾Ğ²)
- ğŸ¯ Ğ˜Ğ·Ğ¾Ğ»Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ğ¾ (Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ±Ğ¸Ğ·Ğ½ĞµÑ-Ğ»Ğ¾Ğ³Ğ¸ĞºĞ°)
- ğŸ”§ ĞšĞ¾Ğ½Ñ‚Ñ€Ğ¾Ğ»Ğ¸Ñ€ÑƒĞµĞ¼Ğ¾ (Ğ»ÑĞ±Ñ‹Ğµ ÑÑ†ĞµĞ½Ğ°Ñ€Ğ¸Ğ¸)
- ğŸ›¡ï¸ ĞĞ°Ğ´ĞµĞ¶Ğ½Ğ¾ (Ğ¿Ñ€ĞµĞ´ÑĞºĞ°Ğ·ÑƒĞµĞ¼Ñ‹Ğµ Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚Ñ‹)

## ğŸ­ ĞŸÑ€Ğ°ĞºÑ‚Ğ¸Ñ‡ĞµÑĞºĞ¸Ğµ Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€Ñ‹ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ

### 1. Ğ¢ĞµÑÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ ÑƒÑĞ¿ĞµÑˆĞ½Ğ¾Ğ¹ Ñ€ĞµĞ³Ğ¸ÑÑ‚Ñ€Ğ°Ñ†Ğ¸Ğ¸

```go
func TestRegisterSuccess(t *testing.T) {
    // Arrange
    mockRepo := new(mocks.IUserRepository)
    mockRepo.On("CreateUser", mock.AnythingOfType("*models.User")).Return(nil)

    authService := &AuthService{UserRepo: mockRepo}

    // Act
    user, err := authService.Register(ctx, "test@example.com", "Password123!")

    // Assert
    assert.NoError(t, err)
    assert.Equal(t, "test@example.com", user.Email)
    mockRepo.AssertExpectations(t)
}
```

### 2. Ğ¢ĞµÑÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ¾ÑˆĞ¸Ğ±ĞºĞ¸ Ğ±Ğ°Ğ·Ñ‹ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…

```go
func TestRegisterDatabaseError(t *testing.T) {
    // Arrange
    mockRepo := new(mocks.IUserRepository)
    mockRepo.On("CreateUser", mock.AnythingOfType("*models.User")).Return(
        errors.New("connection failed"),
    )

    authService := &AuthService{UserRepo: mockRepo}

    // Act
    user, err := authService.Register(ctx, "test@example.com", "Password123!")

    // Assert
    assert.Error(t, err)
    assert.Nil(t, user)
    assert.Contains(t, err.Error(), "connection failed")
}
```

### 3. Ğ¢ĞµÑÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ²Ğ°Ğ»Ğ¸Ğ´Ğ°Ñ†Ğ¸Ğ¸ Ğ»Ğ¾Ğ³Ğ¸Ğ½Ğ°

```go
func TestLoginValidation(t *testing.T) {
    // Arrange
    mockRepo := new(mocks.IUserRepository)
    mockRepo.On("ValidateUser", "test@example.com", "Password123!").Return(
        &models.User{Email: "test@example.com"}, nil,
    )

    authService := &AuthService{UserRepo: mockRepo, JWTSecret: []byte("secret")}

    // Act
    token, user, err := authService.Login(ctx, "test@example.com", "Password123!")

    // Assert
    assert.NoError(t, err)
    assert.NotEmpty(t, token)
    assert.Equal(t, "test@example.com", user.Email)
}
```

## ğŸ”„ Ğ Ğ°Ğ·Ğ½Ğ¸Ñ†Ğ° Ğ¼ĞµĞ¶Ğ´Ñƒ IDatabase Ğ¸ IUserRepository Ğ¼Ğ¾ĞºĞ°Ğ¼Ğ¸

### IDatabase Ğ¼Ğ¾Ğº
- **Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚ÑÑ Ğ´Ğ»Ñ:** Ñ‚ĞµÑÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ UserRepository
- **Ğ§Ñ‚Ğ¾ Ğ¼Ğ¾ĞºĞ°ĞµÑ‚:** Ğ½Ğ¸Ğ·ĞºĞ¾ÑƒÑ€Ğ¾Ğ²Ğ½ĞµĞ²Ñ‹Ğµ Ğ¾Ğ¿ĞµÑ€Ğ°Ñ†Ğ¸Ğ¸ Ğ‘Ğ” (Create, Where, First, Error)
- **ĞšĞ¾Ğ³Ğ´Ğ° Ğ½ÑƒĞ¶ĞµĞ½:** ĞºĞ¾Ğ³Ğ´Ğ° Ñ‚ĞµÑÑ‚Ğ¸Ñ€ÑƒĞµĞ¼ Ğ»Ğ¾Ğ³Ğ¸ĞºÑƒ Ñ€ĞµĞ¿Ğ¾Ğ·Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ñ

### IUserRepository Ğ¼Ğ¾Ğº
- **Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚ÑÑ Ğ´Ğ»Ñ:** Ñ‚ĞµÑÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ AuthService
- **Ğ§Ñ‚Ğ¾ Ğ¼Ğ¾ĞºĞ°ĞµÑ‚:** Ğ²Ñ‹ÑĞ¾ĞºĞ¾ÑƒÑ€Ğ¾Ğ²Ğ½ĞµĞ²Ñ‹Ğµ Ğ¾Ğ¿ĞµÑ€Ğ°Ñ†Ğ¸Ğ¸ (CreateUser, GetUserByEmail, ValidateUser)
- **ĞšĞ¾Ğ³Ğ´Ğ° Ğ½ÑƒĞ¶ĞµĞ½:** ĞºĞ¾Ğ³Ğ´Ğ° Ñ‚ĞµÑÑ‚Ğ¸Ñ€ÑƒĞµĞ¼ Ğ±Ğ¸Ğ·Ğ½ĞµÑ-Ğ»Ğ¾Ğ³Ğ¸ĞºÑƒ ÑĞµÑ€Ğ²Ğ¸ÑĞ°

## ğŸ¯ ĞšĞ¾Ğ³Ğ´Ğ° Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ¼Ğ¾ĞºĞ¸?

### âœ… Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞ¹Ñ‚Ğµ Ğ¼Ğ¾ĞºĞ¸ Ğ´Ğ»Ñ:
- Unit Ñ‚ĞµÑÑ‚Ğ¾Ğ² Ğ±Ğ¸Ğ·Ğ½ĞµÑ-Ğ»Ğ¾Ğ³Ğ¸ĞºĞ¸
- Ğ¢ĞµÑÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ¸ Ğ¾ÑˆĞ¸Ğ±Ğ¾Ğº
- Ğ˜Ğ·Ğ¾Ğ»ÑÑ†Ğ¸Ğ¸ ĞºĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚Ğ¾Ğ²
- Ğ‘Ñ‹ÑÑ‚Ñ€Ñ‹Ñ… Ñ‚ĞµÑÑ‚Ğ¾Ğ²

### âŒ ĞĞ• Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞ¹Ñ‚Ğµ Ğ¼Ğ¾ĞºĞ¸ Ğ´Ğ»Ñ:
- Integration Ñ‚ĞµÑÑ‚Ğ¾Ğ²
- Ğ¢ĞµÑÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ Ñ€ĞµĞ°Ğ»ÑŒĞ½Ñ‹Ñ… Ğ¸Ğ½Ñ‚ĞµĞ³Ñ€Ğ°Ñ†Ğ¸Ğ¹
- End-to-end Ñ‚ĞµÑÑ‚Ğ¾Ğ²

## ğŸ—ï¸ ĞÑ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ½Ñ‹Ğµ Ğ¿Ñ€ĞµĞ¸Ğ¼ÑƒÑ‰ĞµÑÑ‚Ğ²Ğ°

### 1. Dependency Injection
```go
type AuthService struct {
    UserRepo IUserRepository // Ğ˜Ğ½Ñ‚ĞµÑ€Ñ„ĞµĞ¹Ñ Ğ²Ğ¼ĞµÑÑ‚Ğ¾ ĞºĞ¾Ğ½ĞºÑ€ĞµÑ‚Ğ½Ğ¾Ğ³Ğ¾ Ñ‚Ğ¸Ğ¿Ğ°
}
```

### 2. Testability
```go
// Ğ’ Ğ¿Ñ€Ğ¾Ğ´Ğ°ĞºÑˆĞµĞ½Ğµ
authService := NewAuthService(realRepo, rabbitmq, secret)

// Ğ’ Ñ‚ĞµÑÑ‚Ğ°Ñ…
authService := NewAuthService(mockRepo, nil, secret)
```

### 3. Loose Coupling
- Ğ¡ĞµÑ€Ğ²Ğ¸Ñ Ğ½Ğµ Ğ·Ğ½Ğ°ĞµÑ‚ Ğ¾ Ğ´ĞµÑ‚Ğ°Ğ»ÑÑ… Ñ€ĞµĞ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸ Ñ€ĞµĞ¿Ğ¾Ğ·Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ñ
- Ğ›ĞµĞ³ĞºĞ¾ Ğ·Ğ°Ğ¼ĞµĞ½Ğ¸Ñ‚ÑŒ Ñ€ĞµĞ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ
- ĞŸÑ€Ğ¾ÑÑ‚Ğ¾Ğµ Ñ‚ĞµÑÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ

## ğŸ“ˆ Ğ ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚Ñ‹ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ Ğ¼Ğ¾ĞºĞ¾Ğ²

| ĞœĞµÑ‚Ñ€Ğ¸ĞºĞ° | Ğ‘ĞµĞ· Ğ¼Ğ¾ĞºĞ¾Ğ² | Ğ¡ Ğ¼Ğ¾ĞºĞ°Ğ¼Ğ¸ |
|---------|-----------|----------|
| Ğ’Ñ€ĞµĞ¼Ñ Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ¸Ñ | 2-5 ÑĞµĞºÑƒĞ½Ğ´ | 0.1-0.5 ÑĞµĞºÑƒĞ½Ğ´ |
| ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ° | Ğ¡Ğ»Ğ¾Ğ¶Ğ½Ğ°Ñ | ĞŸÑ€Ğ¾ÑÑ‚Ğ°Ñ |
| ĞĞ°Ğ´ĞµĞ¶Ğ½Ğ¾ÑÑ‚ÑŒ | Ğ¡Ñ€ĞµĞ´Ğ½ÑÑ | Ğ’Ñ‹ÑĞ¾ĞºĞ°Ñ |
| Ğ˜Ğ·Ğ¾Ğ»ÑÑ†Ğ¸Ñ | ĞĞ¸Ğ·ĞºĞ°Ñ | Ğ’Ñ‹ÑĞ¾ĞºĞ°Ñ |
| ĞŸĞ¾ĞºÑ€Ñ‹Ñ‚Ğ¸Ğµ edge cases | Ğ¡Ğ»Ğ¾Ğ¶Ğ½Ğ¾ | Ğ›ĞµĞ³ĞºĞ¾ |
