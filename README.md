# Subscription Service

ะะธะบัะพัะตัะฒะธัะฝะฐั ะฐััะธัะตะบัััะฐ ะดะปั ัะฟัะฐะฒะปะตะฝะธั ะฟะพะดะฟะธัะบะฐะผะธ ะฟะพะปัะทะพะฒะฐัะตะปะตะน, ะฟะพัััะพะตะฝะฝะฐั ะฝะฐ Go ั ะธัะฟะพะปัะทะพะฒะฐะฝะธะตะผ gRPC, PostgreSQL ะธ Docker.

## ๐ ะะฑะทะพั ะฟัะพะตะบัะฐ

ะญัะพั ะฟัะพะตะบั ะดะตะผะพะฝัััะธััะตั ัะพะฒัะตะผะตะฝะฝัะต ะฟะพะดัะพะดั ะบ ัะฐะทัะฐะฑะพัะบะต backend-ัะธััะตะผ ะธ ะฒะบะปััะฐะตั ะฒ ัะตะฑั:

- **ะะธะบัะพัะตัะฒะธัะฝัั ะฐััะธัะตะบัััั** ั ัะฐะทะดะตะปะตะฝะธะตะผ ะฝะฐ auth-service ะธ core-service
- **ะัะดะตะปัะฝัะต ะฑะฐะทั ะดะฐะฝะฝัั** ะดะปั ะบะฐะถะดะพะณะพ ัะตัะฒะธัะฐ (Database per Service pattern)
- **gRPC API** ะดะปั ะฒััะพะบะพะฟัะพะธะทะฒะพะดะธัะตะปัะฝะพะณะพ ะผะตะถัะตัะฒะธัะฝะพะณะพ ะฒะทะฐะธะผะพะดะตะนััะฒะธั
- **JWT-ะฐััะตะฝัะธัะธะบะฐัะธั** ะดะปั ะฑะตะทะพะฟะฐัะฝะพััะธ
- **PostgreSQL** ั ะผะธะณัะฐัะธัะผะธ ะฑะฐะทั ะดะฐะฝะฝัั
- **Docker Compose** ะดะปั ะพัะบะตัััะฐัะธะธ ัะตัะฒะธัะพะฒ
- **Health checks** ะดะปั ะผะพะฝะธัะพัะธะฝะณะฐ ัะพััะพัะฝะธั ัะตัะฒะธัะพะฒ

## ๐๏ธ ะััะธัะตะบัััะฐ

```
                        โโโโโโโโโโโโโโโโโโโ    โโโโโโโโโโโโโโโโโโโ
                        โ   Auth Service  โ    โ   Core Service  โ
          โโโโโโโโโโโโโโบโ   (gRPC:50051)  โโโโโบโ   (HTTP:8080)   โ
          |             โโโโโโโโโโโฌโโโโโโโโ    โโโโโโโโโโโฌโโโโโโโโ
          |                       โ                      โ
          |                       โผ                      โผ
โโโโโโโโโโโโโโโโโโโ     โโโโโโโโโโโโโโโโโโโ    โโโโโโโโโโโโโโโโโโโ
โ    RabbitMQ     โ     โ   Auth DB       โ    โ   Core DB       โ
โ (Event Bus)     โ     โ (users, auth)   โ    โ (subscriptions) โ
โ Port: 5672      โ     โ Port: 5433      โ    โ Port: 5434      โ
โโโโโโโโโโโฌโโโโโโโโ     โโโโโโโโโโโโโโโโโโโ    โโโโโโโโโโโโโโโโโโโ
          โ
          โผ
โโโโโโโโโโโโโโโโโโโ
โNotification Svc โ
โ   (HTTP:8082)   โ
โโโโโโโโโโโฌโโโโโโโโ
          โ
          โผ
โโโโโโโโโโโโโโโโโโโ
โ  Notification DBโ
โ (notifications) โ
โ Port: 5435      โ
โโโโโโโโโโโโโโโโโโโ

ะะพัะพะบ ัะพะฑััะธะน:
Auth Service โ RabbitMQ โ Notification Service
(user.created) โ (event bus) โ (processes event)
```

### ะกะตัะฒะธัั

- **Auth Service**: ะััะตะฝัะธัะธะบะฐัะธั ะฟะพะปัะทะพะฒะฐัะตะปะตะน, JWT ัะพะบะตะฝั, gRPC API, ะพัะฟัะฐะฒะบะฐ ัะพะฑััะธะน ะฒ RabbitMQ
- **Core Service**: ะัะฝะพะฒะฝะฐั ะฑะธะทะฝะตั-ะปะพะณะธะบะฐ ัะฟัะฐะฒะปะตะฝะธั ะฟะพะดะฟะธัะบะฐะผะธ, REST API
- **Notification Service**: ะะฑัะฐะฑะพัะบะฐ ัะพะฑััะธะน ะธะท RabbitMQ ะธ ะพัะฟัะฐะฒะบะฐ ัะฒะตะดะพะผะปะตะฝะธะน, HTTP API
- **Auth Database**: PostgreSQL ะฑะฐะทะฐ ะดะปั ะฟะพะปัะทะพะฒะฐัะตะปะตะน ะธ ะฐััะตะฝัะธัะธะบะฐัะธะธ
- **Core Database**: PostgreSQL ะฑะฐะทะฐ ะดะปั ะฟะพะดะฟะธัะพะบ ะธ ะฑะธะทะฝะตั-ะดะฐะฝะฝัั
- **Notification Database**: PostgreSQL ะฑะฐะทะฐ ะดะปั ัะฒะตะดะพะผะปะตะฝะธะน
- **RabbitMQ**: Message broker ะดะปั ะฐัะธะฝััะพะฝะฝะพะณะพ ะฒะทะฐะธะผะพะดะตะนััะฒะธั ะผะตะถะดั ัะตัะฒะธัะฐะผะธ

## ๐๏ธ ะขะตัะฝะพะปะพะณะธัะตัะบะธะน ััะตะบ

### Backend
- **Go 1.24** - ะพัะฝะพะฒะฝะพะน ัะทัะบ ะฟัะพะณัะฐะผะผะธัะพะฒะฐะฝะธั
- **gRPC** - ะผะตะถัะตัะฒะธัะฝะพะต ะฒะทะฐะธะผะพะดะตะนััะฒะธะต
- **PostgreSQL** - ะพัะดะตะปัะฝัะต ะฑะฐะทั ะดะฐะฝะฝัั ะดะปั ะบะฐะถะดะพะณะพ ัะตัะฒะธัะฐ
- **JWT** - ะฐััะตะฝัะธัะธะบะฐัะธั ะธ ะฐะฒัะพัะธะทะฐัะธั
- **Docker & Docker Compose** - ะบะพะฝัะตะนะฝะตัะธะทะฐัะธั

### DevOps
- **Dockerfile** - ะผัะปััะธััะฐะดะธะนะฝะฐั ัะฑะพัะบะฐ
- **Docker Compose** - ะพัะบะตัััะฐัะธั ัะตัะฒะธัะพะฒ
- **Health Checks** - ะผะพะฝะธัะพัะธะฝะณ ัะพััะพัะฝะธั
- **Database Migrations** - ะฐะฒัะพะผะฐัะธัะตัะบะพะต ัะฟัะฐะฒะปะตะฝะธะต ััะตะผะพะน ะะ ัะตัะตะท ะบะพะฝัะตะนะฝะตัั

## ๐ ะัััััะน ััะฐัั

### ะัะตะดะฒะฐัะธัะตะปัะฝัะต ััะตะฑะพะฒะฐะฝะธั
- Docker & Docker Compose
- Git

### ะะฐะฟััะบ ะฟัะพะตะบัะฐ

1. **ะะปะพะฝะธัะพะฒะฐะฝะธะต ัะตะฟะพะทะธัะพัะธั**
```bash
git clone <repository-url>
cd subs-service
```

2. **ะะฐัััะพะนะบะฐ ะฟะตัะตะผะตะฝะฝัั ะพะบััะถะตะฝะธั**
```bash
sh generate-env.sh
# ะััะตะดะฐะบัะธััะนัะต .env ัะฐะนะป ะฟะพะด ะฒะฐัะธ ะฝัะถะดั
```

3. **ะะฐะฟััะบ ะฒัะตั ัะตัะฒะธัะพะฒ**
```bash
docker-compose up -d
```

4. **ะัะพะฒะตัะบะฐ ัะพััะพัะฝะธั ัะตัะฒะธัะพะฒ**
```bash
docker-compose ps
```

### ะะพัััะฟะฝัะต endpoints

- **Auth Service**: gRPC ะฝะฐ ะฟะพััั 50051
- **Core Service Health**: http://localhost:8080/health
- **Core Service API**: http://localhost:8080/api/v1/
- **Notification Service Health**: http://localhost:8082/health
- **RabbitMQ Management**: http://localhost:15672 (guest/guest)

### ะะฐะทั ะดะฐะฝะฝัั

- **Auth Database**: localhost:5433 (auth_user/auth_pass/auth_db)
- **Core Database**: localhost:5434 (core_user/core_pass/core_db)
- **Notification Database**: localhost:5435 (notify_user/notify_pass/notify_db)

## ๐ ะกัััะบัััะฐ ะฟัะพะตะบัะฐ

```
.
โโโ auth-service/           # ะกะตัะฒะธั ะฐััะตะฝัะธัะธะบะฐัะธะธ
โ   โโโ cmd/               # ะขะพัะบะธ ะฒัะพะดะฐ
โ   โโโ internal/          # ะะฝัััะตะฝะฝัั ะปะพะณะธะบะฐ
โ   โ   โโโ models/        # ะะพะดะตะปะธ ะดะฐะฝะฝัั auth-service
โ   โ   โโโ services/      # ะะธะทะฝะตั-ะปะพะณะธะบะฐ (ะฒะบะปััะฐั RabbitMQ)
โ   โ   โโโ ...
โ   โโโ migrations/        # SQL ะผะธะณัะฐัะธะธ ะดะปั auth ะะ
โ   โโโ Dockerfile         # ะะพะฝัะตะนะฝะตั auth-service
โโโ core-service/          # ะัะฝะพะฒะฝะพะน ัะตัะฒะธั
โ   โโโ cmd/               # ะขะพัะบะธ ะฒัะพะดะฐ
โ   โโโ internal/          # ะะฝัััะตะฝะฝัั ะปะพะณะธะบะฐ
โ   โ   โโโ models/        # ะะพะดะตะปะธ ะดะฐะฝะฝัั core-service
โ   โ   โโโ ...
โ   โโโ migrations/        # SQL ะผะธะณัะฐัะธะธ ะดะปั core ะะ
โ   โโโ Dockerfile         # ะะพะฝัะตะนะฝะตั core-service
โโโ notification-service/   # ะกะตัะฒะธั ัะฒะตะดะพะผะปะตะฝะธะน
โ   โโโ cmd/               # ะขะพัะบะธ ะฒัะพะดะฐ
โ   โโโ internal/          # ะะฝัััะตะฝะฝัั ะปะพะณะธะบะฐ
โ   โ   โโโ models/        # ะะพะดะตะปะธ ะดะฐะฝะฝัั notification-service
โ   โ   โโโ services/      # RabbitMQ ะพะฑัะฐะฑะพััะธะบ ัะพะฑััะธะน
โ   โ   โโโ ...
โ   โโโ migrations/        # SQL ะผะธะณัะฐัะธะธ ะดะปั notification ะะ
โ   โโโ Dockerfile         # ะะพะฝัะตะนะฝะตั notification-service
โโโ docs/                  # ะะพะบัะผะตะฝัะฐัะธั
โโโ docker-compose.yaml    # ะัะบะตัััะฐัะธั ัะตัะฒะธัะพะฒ
โโโ README.md             # ะญัะพั ัะฐะนะป
```

## ๐ง ะะฐะทัะฐะฑะพัะบะฐ

### ะะพะบะฐะปัะฝะฐั ัะฐะทัะฐะฑะพัะบะฐ

1. **ะฃััะฐะฝะพะฒะบะฐ ะทะฐะฒะธัะธะผะพััะตะน**
```bash
cd auth-service && go mod download
cd ../core-service && go mod download
```

2. **ะะฐะฟััะบ ะพัะดะตะปัะฝะพะณะพ ัะตัะฒะธัะฐ**
```bash
# ะขะพะปัะบะพ auth-service
docker-compose up -d auth-db auth-migrator
docker-compose up auth-service

# ะขะพะปัะบะพ core-service
docker-compose up -d core-db core-migrator auth-service
docker-compose up core-service
```

### ะะธะณัะฐัะธะธ ะฑะฐะทั ะดะฐะฝะฝัั

ะะธะณัะฐัะธะธ ะฒัะฟะพะปะฝััััั ะฐะฒัะพะผะฐัะธัะตัะบะธ ะฟัะธ ะทะฐะฟััะบะต ัะตัะตะท Docker Compose. ะะปั ัััะฝะพะณะพ ัะฟัะฐะฒะปะตะฝะธั:

```bash
# ะัะธะผะตะฝะธัั ะผะธะณัะฐัะธะธ auth-service
docker-compose up auth-migrator

# ะัะธะผะตะฝะธัั ะผะธะณัะฐัะธะธ core-service
docker-compose up core-migrator

# ะัะบะฐัะธัั ะผะธะณัะฐัะธะธ
# Auth service (ะธัะฟะพะปัะทัะนัะต ะฟะตัะตะผะตะฝะฝัะต ะธะท .env)
docker-compose run --rm auth-migrator -path=/migrations -database="postgres://${AUTH_DB_USER}:${AUTH_DB_PASSWORD}@auth-db:5432/${AUTH_DB_NAME}?sslmode=${AUTH_DB_SSLMODE}" down

# Core service (ะธัะฟะพะปัะทัะนัะต ะฟะตัะตะผะตะฝะฝัะต ะธะท .env)
docker-compose run --rm core-migrator -path=/migrations -database="postgres://${CORE_DB_USER}:${CORE_DB_PASSWORD}@core-db:5432/${CORE_DB_NAME}?sslmode=${CORE_DB_SSLMODE}" down
```

## ๐งช ะขะตััะธัะพะฒะฐะฝะธะต

### Health Checks
```bash
# ะัะพะฒะตัะบะฐ auth-service
curl http://localhost:8081/health

# ะัะพะฒะตัะบะฐ core-service
curl http://localhost:8080/health
```

### API ัะตััะธัะพะฒะฐะฝะธะต
```bash
# ะัะธะผะตั ัะตะณะธัััะฐัะธะธ ะฟะพะปัะทะพะฒะฐัะตะปั (ะตัะปะธ ัะตะฐะปะธะทะพะฒะฐะฝะพ)
curl -X POST http://localhost:8080/api/v1/users/register \
  -H "Content-Type: application/json" \
  -d '{"email":"test@example.com","password":"password123"}'
```

## ๐ ะะตะทะพะฟะฐัะฝะพััั

- JWT ัะพะบะตะฝั ะดะปั ะฐััะตะฝัะธัะธะบะฐัะธะธ
- ะะตัะตะผะตะฝะฝัะต ะพะบััะถะตะฝะธั ะดะปั ะบะพะฝัะธะดะตะฝัะธะฐะปัะฝัั ะดะฐะฝะฝัั
- ะะตะฟัะธะฒะธะปะตะณะธัะพะฒะฐะฝะฝัะต ะฟะพะปัะทะพะฒะฐัะตะปะธ ะฒ ะบะพะฝัะตะนะฝะตัะฐั
- ะะทะพะปะธัะพะฒะฐะฝะฝัะต ะฑะฐะทั ะดะฐะฝะฝัั ะดะปั ะบะฐะถะดะพะณะพ ัะตัะฒะธัะฐ
- Health checks ะดะปั ะผะพะฝะธัะพัะธะฝะณะฐ

## ๐ ะะพะฝะธัะพัะธะฝะณ

ะัะพะตะบั ะฒะบะปััะฐะตั health checks ะดะปั ะฒัะตั ัะตัะฒะธัะพะฒ:
- Database health check ั pg_isready ะดะปั ะบะฐะถะดะพะน ะะ
- HTTP health endpoints ะดะปั ัะตัะฒะธัะพะฒ
- ะะฐัััะพะตะฝะฝัะต retry ะฟะพะปะธัะธะบะธ

## ๐ ะะตะฟะปะพะน

ะัะพะตะบั ะณะพัะพะฒ ะบ ะดะตะฟะปะพั ะฒ ะปัะฑะพะน ััะตะดะต, ะฟะพะดะดะตัะถะธะฒะฐััะตะน Docker:
- Kubernetes
- Docker Swarm
- Cloud platforms (AWS, GCP, Azure)

## ๐ ะะธัะตะฝะทะธั

ะญัะพั ะฟัะพะตะบั ัะพะทะดะฐะฝ ะฒ ััะตะฑะฝัั ัะตะปัั ะธ ะดะปั ะดะตะผะพะฝัััะฐัะธะธ ะฝะฐะฒัะบะพะฒ ัะฐะทัะฐะฑะพัะบะธ.

---

## ๐ก ะขะตัะฝะธัะตัะบะธะต ัะตัะตะฝะธั

### ะะพัะตะผั ะผะธะบัะพัะตัะฒะธัั?
- ะะตะผะพะฝัััะฐัะธั ะฝะฐะฒัะบะพะฒ ะฟัะพะตะบัะธัะพะฒะฐะฝะธั ัะฐัะฟัะตะดะตะปะตะฝะฝัั ัะธััะตะผ
- ะะพะทะผะพะถะฝะพััั ะฝะตะทะฐะฒะธัะธะผะพะณะพ ะผะฐัััะฐะฑะธัะพะฒะฐะฝะธั ะบะพะผะฟะพะฝะตะฝัะพะฒ
- ะะฐะทะดะตะปะตะฝะธะต ะพัะฒะตัััะฒะตะฝะฝะพััะธ ะผะตะถะดั ัะตัะฒะธัะฐะผะธ

### ะะพัะตะผั ะพัะดะตะปัะฝัะต ะะ?
- **Database per Service pattern** - ะบะฐะถะดัะน ัะตัะฒะธั ะฒะปะฐะดะตะตั ัะฒะพะธะผะธ ะดะฐะฝะฝัะผะธ
- ะะตะทะฐะฒะธัะธะผะพะต ะผะฐัััะฐะฑะธัะพะฒะฐะฝะธะต ะฑะฐะท ะดะฐะฝะฝัั
- ะะทะพะปััะธั ะดะฐะฝะฝัั ะธ ะฑะตะทะพะฟะฐัะฝะพััั
- ะะพะทะผะพะถะฝะพััั ะธัะฟะพะปัะทะพะฒะฐะฝะธั ัะฐะทะฝัั ัะธะฟะพะฒ ะะ ะดะปั ัะฐะทะฝัั ัะตัะฒะธัะพะฒ

### ะะพัะตะผั gRPC?
- ะััะพะบะฐั ะฟัะพะธะทะฒะพะดะธัะตะปัะฝะพััั ะฑะธะฝะฐัะฝะพะณะพ ะฟัะพัะพะบะพะปะฐ
- ะกััะพะณะฐั ัะธะฟะธะทะฐัะธั ัะตัะตะท Protocol Buffers
- ะัััะพะตะฝะฝะฐั ะฟะพะดะดะตัะถะบะฐ streaming

### ะะพัะตะผั PostgreSQL?
- ACID-ัะพะฒะผะตััะธะผะพััั ะดะปั ะบัะธัะธัะตัะบะธ ะฒะฐะถะฝัั ะดะฐะฝะฝัั
- ะะพัะฝัะต ะฒะพะทะผะพะถะฝะพััะธ ะดะปั ัะปะพะถะฝัั ะทะฐะฟัะพัะพะฒ
- ะะฐะดะตะถะฝะพััั ะธ ะฟัะพะธะทะฒะพะดะธัะตะปัะฝะพััั

### ะะพัะตะผั ะบะพะฝัะตะนะฝะตั-ะผะธะณัะฐัะพัั?
- ะัะดะตะปัะฝัะน ััะฐะฟ ะผะธะณัะฐัะธะน ะฒ CI/CD pipeline
- ะะตะทะพะฟะฐัะฝะพััั - ะผะธะณัะฐัะธะธ ะฝะต ะฒะปะธััั ะฝะฐ ัะฐะฑะพัั ัะตัะฒะธัะพะฒ
- ะะพะทะผะพะถะฝะพััั ะพัะบะฐัะฐ ะผะธะณัะฐัะธะน
- Production-ready ะฟะพะดัะพะด

ะญัะพั ะฟัะพะตะบั ะดะตะผะพะฝัััะธััะตั ะทะฝะฐะฝะธะต ัะพะฒัะตะผะตะฝะฝัั ะฟัะฐะบัะธะบ ัะฐะทัะฐะฑะพัะบะธ backend-ัะธััะตะผ ะธ ะณะพัะพะฒะฝะพััั ะบ ัะฐะฑะพัะต ะฒ production-ะพะบััะถะตะฝะธะธ.